<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Carlo 'carlovo' van Overbeek">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Walkthrough - Paleofuturistic Python</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Paleofuturistic Python</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Walkthrough</a>
                            </li>
                            <li class="nav-item">
                                <a href="../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../about/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/schubergphilis/paleofuturistic_python/blob/main/docs/walkthrough.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="true">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#walkthrough" class="nav-link">Walkthrough</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#initializing-your-project" class="nav-link">Initializing your project</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dependency-management" class="nav-link">Dependency management</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#quality-assurance-formatting-linting-type-checking-and-testing" class="nav-link">Quality assurance (formatting, linting, type checking and testing)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#building-your-package" class="nav-link">Building your package</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#previewing-and-publishing-your-documentation" class="nav-link">Previewing and publishing your documentation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#publishing-your-python-package" class="nav-link">Publishing your Python package</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#bonus-tinkering-within-context" class="nav-link">Bonus: tinkering within context</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#the-updated-happy-path-workflow" class="nav-link">The updated happy path workflow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="walkthrough">Walkthrough</h1>
<p>Some things in <a href="../#usage">usage</a> might require a little more effort on the first run.
Let's go over those things and the rest in a little more detail.</p>
<h2 id="initializing-your-project">Initializing your project</h2>
<p>You will probably want to manage your project with some version control system and a remote, such as Git and GitHub.
Personally, I like creating the repository in the remote and then cloning to local.
That way everything is nicely set up for me.
Except for the template, of course.</p>
<p><a href="https://cruft.github.io/cruft/">cruft</a> (<a href="https://cookiecutter.readthedocs.io/en/stable/">cookiecutter</a> under its hood) does not allow editing an existing directory by default for safety.
Because we just cloned an empty repository, we can assume to be safe though.
Clone your new repository somewhere.
From the directory directly above it run:
<code>uvx cruft create -f --checkout latest https://github.com/schubergphilis/paleofuturistic_python</code>
(mind the <code>-f</code>).
cd to your project directory; git add all, commit and push; and you are ready to go.</p>
<p>Other options would be:</p>
<ul>
<li>create the project with directory from the template with cruft, cd to it; git init, add all, commit, <a href="https://docs.github.com/en/get-started/getting-started-with-git/about-remote-repositories#creating-remote-repositories">set the remote</a> and push.</li>
<li>create the project with directory from the template with cruft, copy the contents to a cloned repository; git add all, commit and push.</li>
</ul>
<h3 id="reviewing-gitignore-and-license">Reviewing .gitignore and LICENSE</h3>
<p>If you had wanted another license than Apache, you have probably already chosen one and can easily override the templated one (if you do, do it in the <code>pyproject.toml</code> as well).
Maybe take a second look at the .gitignore, maybe not, it's fine...</p>
<h2 id="dependency-management">Dependency management</h2>
<p>Usually a lot or even more of the low-level functionality you need for what you want to develop is already available.
Luckily, reeling that good stuff in is one of uv's strengths.
To download all dependencies to get started properly run <code>uv sync --all-extras --dev</code>.
The <code>--all-extras --dev</code> flags trigger downloading optional and development dependencies respectively.
After that you can add dependencies like <code>uv add requests</code>.</p>
<p>These commands do everything you would hope they to do by default.
Yes, that includes caching and project-based isolation.
For starters just adding some dependencies from PyPI is probably all you want.
All the other things you would want from (uv's) dependency management you can always look into later.</p>
<p>By now you might have already guessed that uv acts on dependencies in your environment and uvx is meant for tools that live outside of it.</p>
<p>Just a reminder: add the names of the public features you develop to the <code>__all__</code> list in <code>__init__.py</code>.
This way others (that includes your unittest runs) can conveniently access them upon importing the module.</p>
<h2 id="quality-assurance-formatting-linting-type-checking-and-testing">Quality assurance (formatting, linting, type checking and testing)</h2>
<p>You can see the config for these steps in the <code>pyproject.toml</code>.
Formatting (<code>uv run ruff format</code>), type checking (<code>uv run mypy</code>) and testing (<code>uv run python -m unittest</code>) should speak for themselves.
The ruff formatter, mypy and Python's build-in testing library are ubiquitous and easy to use.</p>
<p>You can get into the weeds very fast with linting (<code>uv run ruff check</code>) though.
If you go with the flow of this template it's probably going to work out fine for your first 1,000 commits or so.
And by that time you can probably figure out how to stop a pesky linter from undoing your intricacies,
so my advice would be to not give it too much thought.
(If you feel like getting into the weeds early though, <a href="https://docs.astral.sh/ruff/configuration/">have at you</a>.)</p>
<h2 id="building-your-package">Building your package</h2>
<p>uv has its own build backend nowadays.
It works only for pure Python projects at the moment, but that's probably good enough for most projects.
If you have more special needs you probably already know what you want and can configure that in the <code>pyproject.toml</code>.</p>
<p>Other than that, this step should simply be a <code>uv build</code> command that just works.</p>
<h2 id="previewing-and-publishing-your-documentation">Previewing and publishing your documentation</h2>
<p>So <code>uvx --with mkdocstrings[python] mkdocs build</code> nicely converts your documentation to a static website...
Now what and what is that magic <code>--with</code> statement?
First the <code>--with</code>, it injects additional dependencies into the environment for mkdocs, in this case mkdocstrings with its python add-on.
Run the command and check you project's documentation to see the fancy feature descriptions mkdocstrings can make for you from a docstring.
(I found mkdocstrings works best with numpy style docs, so that's the template's default; you can change that in the <code>mkdocs.yaml</code>.)</p>
<p>Wait, how do I check my documentation and how do I publish it?
MkDocs has two convenient commands build in for that:</p>
<ul>
<li><code>uvx --with mkdocstrings[python] mkdocs serve</code> will serve a preview on local host <code>http://127.0.0.1:8000/</code> (with watch files!).</li>
<li><code>uvx --with mkdocstrings[python] mkdocs gh-deploy</code> will upload your documentation to GitHub Pages.</li>
</ul>
<p>Both these commands have a lot of options and MkDocs has a lot more to offer in general (including automated publishing to other hosting parties).
<a href="https://www.mkdocs.org/">See for yourself.</a></p>
<h2 id="publishing-your-python-package">Publishing your Python package</h2>
<blockquote>
<p>Before going forward, don't forget to version bump in the <code>pyproject.toml</code> and forward that to the lockfile with <code>uv lock</code>.<br />
Also, replace <code>paleofuturistic_python</code> to your project's slug in the examples below.</p>
</blockquote>
<p>It's all done; time to make your work available to the masses!
<code>uv publish</code> can be configured to go a lot of places, but let's just admit PyPI is the standard.</p>
<p>While you can make an account at <a href="https://pypi.org/">PyPI</a>,
download a credential
and <a href="https://docs.astral.sh/uv/guides/publish/#publishing-your-package">configure uv</a> to publish that way,
it might be a better a idea to replace the credentials with <a href="https://docs.pypi.org/trusted-publishers/adding-a-publisher/">configuring a trusted publisher</a>.
If you follow the trusted publisher guide you only have to change the owner and repository name from the example to make the release flow of this template work.</p>
<p>Afterwards run <code>uv run --isolated --no-project --with paleofuturistic_python python -c "import paleofuturistic_python; print(paleofuturistic_python.hello())"</code> to test whether everything went OK.</p>
<h3 id="executable-apps">Executable apps</h3>
<p>Up until now we haven't specified yet whether the project is creating a package that will be a library or application.
This workflow template was created for libraries, because those are usually the most involved to get going.
Making the template able to produce Python apps is not much work luckily.
(Making stand-alone apps is a whole other story though!
In that case you may want to look at <a href="https://pyinstaller.org/">PyInstaller</a> or <a href="https://nuitka.net/">Nuitka</a> for example.)</p>
<p>To make the package an executable module that supports something like <code>python -m paleofuturistic_python</code> (or <code>uv run --isolated --no-project --with paleofuturistic_python python -m paleofuturistic_python</code>) create a <code>__main__.py</code> that looks something like:</p>
<pre><code class="language-Python">from paleofuturistic_python import hello


def main() -&gt; None:
    print(hello())


if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<p>Then to make tools like uvx and pipx be able to execute the module like so <code>uvx --with paleofuturistic_python paleofuturistic_python</code> add the following to the <code>pyproject.toml</code>.</p>
<pre><code class="language-toml">[project.scripts]
paleofuturistic_python = &quot;paleofuturistic_python.__main__:main&quot;
</code></pre>
<p>If you are setting out to build an app, you can implement all the boilerplate yourself with <code>os</code> and <code>argparse</code>.
You could also look into available frameworks, for example for CLIs: <a href="https://typer.tiangolo.com/">Typer</a>.</p>
<h3 id="security-considerations">Security considerations</h3>
<p>Note you have just bestowed great power upon GitHub.
With great power comes... No wait we have something serious to say here!</p>
<p>If you followed the guides linked above you will have already setup a separate GitHub env for publishing and made use of PyPI's trusted publishing.
That's great, but it's advisable to put up an even higher fence against attacks.</p>
<p>You can for example use the following settings to protect your repository from outsiders:</p>
<ul>
<li>Protect at least the <code>main</code> branch and <code>v*</code> tags with rulesets; configure them to enforce updates via peer-reviewed pull requests from forks.</li>
<li>Enable "Limit to users explicitly granted read or higher access" under "Code review limits".</li>
<li>Set "Require approval for all external contributors" under "Actions permissions" -&gt; "Approval for running fork pull request workflows from contributors".</li>
<li>Set "Read repository contents and packages permissions" (no default repo write) under "Actions permissions" -&gt; "Workflow permissions".</li>
<li>Uncheck "Allow GitHub Actions to create and approve pull requests" under "Actions permissions" -&gt; "Workflow permissions".</li>
<li>You could even go as far as setting "Temporary interaction limits" under "Interaction limits".</li>
</ul>
<p>Protecting your repository from insider threats is far harder, but this might help:</p>
<ul>
<li>Set some "Required reviewers" under "Environments" -&gt; "Deployment protection rules".</li>
<li>Cumbersome to implement, but effective: org/repo admin access only for non-personal accounts which require 4-eyes approval for assuming.</li>
</ul>
<h2 id="bonus-tinkering-within-context">Bonus: tinkering within context</h2>
<p>You could simply run <code>uv run python</code> and tinker away in your virtual env, but quality of life in ptpython's REPL is simply much better.
Directly running <code>uvx ptpython</code> doesn't work here, because uv's whole point is env separation.
To give your current project's context to ptpython you can run <code>uvx --with-editable . ptpython</code>.
<code>--with-editable</code> is used instead of <code>--with</code> to make uv look at the latest local updates of your code.</p>
<h2 id="the-updated-happy-path-workflow">The updated happy path workflow</h2>
<p>When you completed all the above successfully, pat yourself on the back for me.
The real reward is of course a reliable way of developing your Python project.
Considering the publishing and all, you may want to alter the workflow in this project's introduction to something like:</p>
<ul>
<li>Download dependencies (if you need any): <code>uv add some_lib_you_need</code></li>
<li>Develop (optional, tinker: <code>uvx --with-editable . ptpython</code>)</li>
<li>QA:<ul>
<li>Format: <code>uv run ruff format</code> (or <code>uv run ruff format --diff</code> if you want to check the proposed changes first)</li>
<li>Lint: <code>uv run ruff check</code> (or simply <code>uv run ruff check --fix</code> if, you also, like to live dangerously)</li>
<li>Type check: <code>uv run mypy</code></li>
<li>Test: <code>uv run python -m unittest</code></li>
</ul>
</li>
<li>Build: <code>uv build</code> (just to test it works)</li>
<li>Preview documentation: <code>uvx --with mkdocstrings[python] mkdocs serve</code></li>
<li>Publish package: kickoff the Publish to PyPI workflow in GitHub Actions</li>
<li>Publish documentation: <code>uvx --with mkdocstrings[python] mkdocs gh-deploy</code></li>
</ul>
<p>Or even better, create your own workflow that exactly caters to your project's needs.</p>
<p>Happy coding ðŸ¤—</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2024 <a href="https://schubergphilis.com/">Schuberg Philis</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
